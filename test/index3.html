<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>窗口3</title>
</head>

<body>
  <h1>Hello World!</h1>
  <br />
  <button type="button" onclick="sendToProvider()">send update cmd to ProviderWindow</button>
  <div id="provider_reply"></div>
  <br />
  <button type="button" onclick="sendToProvider2()">send getTime cmd to ProviderWindow</button>
  <div id="provider_reply2"></div>
  <br>

</body>
<script>
  const { ResolverDelegate } = require('../dist');
  const PARAMS = require('./cfg');

  const resolverDelegate = new ResolverDelegate(PARAMS.TAG_WIN_PROVIDER);

  async function sendToProvider() {
    console.log('send update cmd to provider.');
    const eleProviderReply = document.getElementById('provider_reply');
    eleProviderReply.innerText = 'sending update cmd to providerwindow...'
    resolverDelegate.send('update_db', { id: '1234', name: 'zhujm' }).then((args) => {
      console.log('get update result ==>', args);
      eleProviderReply.innerText = 'get update result:' + JSON.stringify(args);
    }).catch(e => {
      console.error('get update result timeout!');
      eleProviderReply.innerText = 'get update result timeout!';
    });

  }

   //异步实现：
  async function sendToProvider2() {
    try {
      const eleProviderReply2 = document.getElementById('provider_reply2');
      eleProviderReply2.innerText = 'sending getTime cmd to providerwindow...'
      const res = await resolverDelegate.send('getTime');
      console.log('getTime:', res);
      eleProviderReply2.innerText = 'getTime:' + JSON.stringify(res);
    } catch (e) {
      console.error('getTime error from provider window!', e);
      eleProviderReply2.innerText = 'getTime cmd error:' + JSON.stringify(e);
    }
  }


</script>

</html>